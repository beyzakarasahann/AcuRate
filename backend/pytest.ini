[pytest]
# Django settings module
# Note: CI uses --ds=backend.test_settings to override this
DJANGO_SETTINGS_MODULE = backend.settings

# Test discovery patterns
python_files = test_*.py *_test.py
python_classes = Test* *Tests
python_functions = test_*

# Test paths
testpaths = api/tests

# Ignore deprecated Django TestCase files (use pytest versions instead)
norecursedirs = .git .venv venv env __pycache__

# Note: Deprecated files are marked but not ignored to allow gradual migration
# To run only pytest tests, use: pytest -k "not test_models and not test_api and not test_serializers and not test_permissions and not test_integration"

# Add options
# Note: --reuse-db reuses test database if it exists (avoids permission issues)
# --nomigrations speeds up tests by skipping migrations
# CI workflows override these with explicit flags
addopts = 
    --verbose
    --strict-markers
    --tb=short
    --cov=api
    --cov-report=term-missing
    --cov-report=html
    --cov-report=xml
    --reuse-db
    --nomigrations

# Markers for organizing tests
markers =
    unit: Unit tests (fast, isolated)
    integration: Integration tests (slower, may use database)
    api: API endpoint tests
    model: Model tests
    permission: Permission tests
    serializer: Serializer tests
    slow: Slow running tests

# Logging
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# Warnings
filterwarnings =
    ignore::django.utils.deprecation.RemovedInDjango60Warning
    ignore::DeprecationWarning

